(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=o(r);fetch(r.href,s)}})();const ee=e=>{e.classList.toggle("card__like-button_is-active")},te=e=>{e.remove()},oe=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),O=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,onInfoClick:r,currentUserId:s})=>{const a=oe(),L=a.querySelector(".card__like-button"),E=a.querySelector(".card__control-button_type_delete"),Y=a.querySelector(".card__control-button_type_info"),q=a.querySelector(".card__image"),P=a.querySelector(".card__like-count");return q.src=e.link,q.alt=e.name,a.querySelector(".card__title").textContent=e.name,P.textContent=e.likes.length,e.likes&&e.likes.some(Z=>Z._id===s)&&L.classList.add("card__like-button_is-active"),e.owner._id!==s&&E.remove(),o&&L.addEventListener("click",()=>o(L,P)),n&&E.addEventListener("click",()=>n(a,e._id)),r&&Y.addEventListener("click",()=>r(e._id)),t&&q.addEventListener("click",()=>t({name:e.name,link:e.link})),a},N=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");l(t)}},p=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",N)},l=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",N)},re=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{l(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&l(e)})},D=(e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);r&&(t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass))},W=(e,t,o)=>{const n=e.querySelector(`#${t.id}-error`);n&&(t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent="")},ne=(e,t,o)=>{const n=t.dataset.errorMessage;t.validity.patternMismatch&&n?D(e,t,n,o):t.validity.valid?W(e,t,o):D(e,t,t.validationMessage,o)},se=e=>e.some(t=>!t.validity.valid),H=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},ce=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},A=(e,t,o)=>{se(e)?H(t,o):ce(t,o)},ae=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);A(o,n,t),o.forEach(r=>{r.addEventListener("input",()=>{ne(e,r,t),A(o,n,t)})})},g=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach(r=>{W(e,r,t)}),H(n,t)},ie=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{o.addEventListener("submit",n=>{n.preventDefault()}),ae(o,e)})},c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"4a4eb6a9-df51-4323-87b2-f3691d0f7fdc","Content-Type":"application/json"}},d=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),le=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(d),j=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(d),de=({name:e,about:t})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(d),ue=e=>fetch(`${c.baseUrl}/users/me/avatar`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(d),pe=({name:e,link:t})=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(d),_e=e=>fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(d),fe=(e,t)=>fetch(`${c.baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:c.headers}).then(o=>d(o)),C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};ie(C);const J=document.querySelector(".places__list"),k=document.querySelector(".popup_type_edit"),y=k.querySelector(".popup__form"),V=y.querySelector(".popup__input_type_name"),R=y.querySelector(".popup__input_type_description"),I=document.querySelector(".popup_type_new-card"),u=I.querySelector(".popup__form"),me=u.querySelector(".popup__input_type_card-name"),ye=u.querySelector(".popup__input_type_url"),x=document.querySelector(".popup_type_image"),$=x.querySelector(".popup__image"),he=x.querySelector(".popup__caption"),Se=document.querySelector(".profile__edit-button"),ve=document.querySelector(".profile__add-button"),B=document.querySelector(".profile__title"),T=document.querySelector(".profile__description"),M=document.querySelector(".profile__image"),w=document.querySelector(".popup_type_edit-avatar"),m=w.querySelector(".popup__form"),Ce=m.querySelector(".popup__input"),U=document.querySelector(".popup_type_remove-card"),z=U.querySelector(".popup__form"),h=document.querySelector(".popup_type_info"),Le=h.querySelector(".popup__title"),_=h.querySelector(".popup__info"),F=h.querySelector(".popup__list"),qe=h.querySelector(".popup__text");let b="";const i=(e,t)=>{if(t){e.dataset.originalText=e.textContent.trim();const o=e.dataset.originalText;o==="Сохранить"?e.textContent="Сохранение...":o==="Создать"?e.textContent="Создание...":o==="Да"?e.textContent="Удаление...":e.textContent="Загрузка...",e.dataset.wasDisabled=e.disabled,e.disabled=!0}else e.dataset.originalText&&(e.textContent=e.dataset.originalText),e.dataset.wasDisabled!==void 0&&(e.disabled=e.dataset.wasDisabled==="true"),delete e.dataset.originalText,delete e.dataset.wasDisabled};let S="",v=null;const K=(e,t)=>{S=e,v=t,p(U)},be=e=>{e.preventDefault();const t=z.querySelector(".popup__button");i(t,!0),S&&v&&_e(S).then(()=>{te(v),l(U),S="",v=null}).catch(o=>{console.log(o)}).finally(()=>{i(t,!1)})},G=({name:e,link:t})=>{$.src=t,$.alt=e,he.textContent=e,p(x)},ge=e=>{e.preventDefault();const t=y.querySelector(".popup__button");i(t,!0),de({name:V.value,about:R.value}).then(o=>{B.textContent=o.name,T.textContent=o.about,l(k)}).catch(o=>{console.log(o)}).finally(()=>{i(t,!1)})},ke=e=>{e.preventDefault();const t=m.querySelector(".popup__button");i(t,!0),ue(Ce.value).then(o=>{M.style.backgroundImage=`url(${o.avatar})`,l(w)}).catch(o=>{console.log(o)}).finally(()=>{i(t,!1)})},Ie=e=>{e.preventDefault();const t=u.querySelector(".popup__button");i(t,!0),pe({name:me.value,link:ye.value}).then(o=>{const n=O(o,{onPreviewPicture:G,onLikeIcon:(r,s)=>{Q(o._id,r,s)},onDeleteCard:(r,s)=>{K(s,r)},onInfoClick:()=>{X(o._id)},currentUserId:b});J.prepend(n),l(I)}).catch(o=>{console.log(o)}).finally(()=>{i(t,!1)})},Q=(e,t,o)=>{const n=t.classList.contains("card__like-button_is-active");fe(e,n).then(r=>{ee(t),o.textContent=r.likes.length}).catch(r=>{console.log(r)})};y.addEventListener("submit",ge);u.addEventListener("submit",Ie);m.addEventListener("submit",ke);z.addEventListener("submit",be);Se.addEventListener("click",()=>{V.value=B.textContent,R.value=T.textContent,g(y,C),p(k)});M.addEventListener("click",()=>{m.reset(),g(m,C),p(w)});ve.addEventListener("click",()=>{u.reset(),g(u,C),p(I)});const xe=document.querySelectorAll(".popup");xe.forEach(e=>{re(e)});const Be=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),f=(e,t)=>{const n=document.getElementById("popup-info-definition-template").content.cloneNode(!0);return n.querySelector(".popup__info-term").textContent=e,n.querySelector(".popup__info-description").textContent=t,n},X=e=>{j().then(t=>{const o=t.find(n=>n._id===e);Le.textContent="Информация о карточке",_.innerHTML="",F.innerHTML="",_.append(f("Описание:",o.name)),_.append(f("Дата создания:",Be(new Date(o.createdAt)))),_.append(f("Владелец:",o.owner.name)),_.append(f("Количество лайков:",o.likes.length.toString())),qe.textContent="Лайкнули:",o.likes.length>0&&o.likes.forEach(n=>{F.append(f(n.name,""))}),p(h)}).catch(t=>{console.log(t)})};Promise.all([j(),le()]).then(([e,t])=>{b=t._id,B.textContent=t.name,T.textContent=t.about,M.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{J.append(O(o,{onPreviewPicture:G,onLikeIcon:(n,r)=>{Q(o._id,n,r)},onDeleteCard:(n,r)=>{K(r,n)},onInfoClick:()=>{X(o._id)},currentUserId:b}))})}).catch(e=>{console.log(e)});
